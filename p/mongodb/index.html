<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='MongoDB常用语句、架构、复制集与分片、集合的设计原则、索引、事务原理，引擎相关的待补充'><title>MongoDB</title>

<link rel='canonical' href='http://nixum.cc/p/mongodb/'>

<link rel="stylesheet" href="/scss/style.min.92530ae6146419b2553c7da1866a1ac352d4c1a4d2f985110524bd60c6094d8c.css"><meta property='og:title' content='MongoDB'>
<meta property='og:description' content='MongoDB常用语句、架构、复制集与分片、集合的设计原则、索引、事务原理，引擎相关的待补充'>
<meta property='og:url' content='http://nixum.cc/p/mongodb/'>
<meta property='og:site_name' content='Nixum Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='MongoDB' /><meta property='article:tag' content='数据库' /><meta property='article:tag' content='数据库-锁' /><meta property='article:tag' content='数据库事务' /><meta property='article:tag' content='索引' /><meta property='article:tag' content='主从架构' /><meta property='article:tag' content='数据库优化' /><meta property='article:published_time' content='2021-11-28T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-12-25T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="MongoDB">
<meta name="twitter:description" content="MongoDB常用语句、架构、复制集与分片、集合的设计原则、索引、事务原理，引擎相关的待补充">
    <link rel="shortcut icon" href="img/favicon.ico" />

    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>









        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" >
                数据库
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/mongodb/">MongoDB</a>
    </h2>

    
    <h3 class="article-subtitle">
        MongoDB常用语句、架构、复制集与分片、集合的设计原则、索引、事务原理，引擎相关的待补充
    </h3>
    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Nov 28, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    3 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <p>[TOC]</p>
<h1 id="特点">特点</h1>
<ol>
<li>分布式数据库，Json数据模型，面向对象数据模型，不强制表的scheme</li>
<li>当应用场景不清晰时，可以直接以对象模型直接存储，无需关心字段，表结构灵活，动态增加新字段</li>
<li>不用太过关注表间的关系，可直接嵌套存储，将多种关系存储在同一张表上，同时也加快查表，因为它可以减少磁盘定位次数，如果是关系型数据库，同时查多张表就需要定位多次</li>
<li>原生支持高可用，一般的部署方式是部署三个节点replica set，最多50个；多replica set可以实现自恢复（当主节点挂点后会选出从节点），异地容灾，数据库滚动更新</li>
<li>原生支持横向扩展，通过水平扩展分片实现，外部并不感知有多少个分片，只会当成一个分片使用</li>
<li>支持字段级加密，针对隐私数据，比如身份证、电话等，在入库时可以进行加密，查询时解密</li>
<li>支持地理位置经纬度查询</li>
<li>强大的聚合查询，适合报表、时序数据</li>
</ol>
<h1 id="nosql语句">NoSQL语句</h1>
<p>客户端使用驱动时连接的执行流程</p>
<p><figure 
	>
	<a href="https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB%e5%ae%a2%e6%88%b7%e7%ab%af%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.jpg" >
		<img src="https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB%e5%ae%a2%e6%88%b7%e7%ab%af%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.jpg"
			
			
			
			loading="lazy"
			alt="客户端执行流程">
	</a>
	
	<figcaption>客户端执行流程</figcaption>
	
</figure></p>
<p>数据库端执行流程</p>
<p><figure 
	>
	<a href="https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB%e6%95%b0%e6%8d%ae%e5%ba%93%e7%ab%af%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.jpg" >
		<img src="https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB%e6%95%b0%e6%8d%ae%e5%ba%93%e7%ab%af%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.jpg"
			
			
			
			loading="lazy"
			alt="数据库端执行流程">
	</a>
	
	<figcaption>数据库端执行流程</figcaption>
	
</figure></p>
<p>要获取ticket是因为MongoDB默认存储引擎wiredtiger的机制，ticket代表着系统资源的数量，ticket数量有限，读写操作都需要先获得ticket才可以进行下一步操作，机制类似信号量。</p>
<h2 id="连接">连接</h2>
<p>连接mongoDB语句，当有多节点或多分片时，连接也要写上，<code>mongodb://节点1的host:port, 节点2的host:port,.../databaseName?[options: maxPoolSize(java默认是100), maxWaitTime(查询的最大等待事件), writeConcern, readConcern]</code></p>
<p>mongoDB驱动里已提供负载均衡，多节点探测</p>
<h2 id="聚合">聚合</h2>
<p>作用相当与group by，可作用与多个collection，可进行查询和计算。Mongo的聚合操作发生在pipeline中，由多个stage组成，有点像责任链，通过多个state来过滤，聚合数据，每一个{}代表一个state</p>
<p>demo</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="n">MySQL中的</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">department</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">emp_QTY</span><span class="w"> 
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="k">User</span><span class="w"> 
</span><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">gender</span><span class="o">=</span><span class="s1">&#39;female&#39;</span><span class="w"> 
</span><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">department</span><span class="w"> 
</span><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">10</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="err">等价于</span><span class="n">mongo中的</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">db</span><span class="p">.</span><span class="k">user</span><span class="p">.</span><span class="k">aggregate</span><span class="p">([</span><span class="w">
</span><span class="w">    </span><span class="err">{</span><span class="w"> </span><span class="err">$</span><span class="k">match</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">gender</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;female&#39;</span><span class="err">}}</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="err">{</span><span class="w">
</span><span class="w">    	</span><span class="err">$</span><span class="k">group</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w">
</span><span class="w">    	     </span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;$DEPARTMENT&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">emp_qty</span><span class="p">:</span><span class="w"> </span><span class="err">{$</span><span class="k">sum</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="w">
</span><span class="w">    	</span><span class="err">}</span><span class="w">
</span><span class="w">    </span><span class="err">}</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="err">{</span><span class="w"> </span><span class="err">$</span><span class="k">match</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">emp_qty</span><span class="p">:</span><span class="w"> </span><span class="err">{$</span><span class="n">lt</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="err">}}}</span><span class="w">
</span><span class="w"></span><span class="p">])</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>几个比较特别的运算符</p>
<p>$unwind：将查询到的数组展开</p>
<p>$grouphLookup：图搜索</p>
<p>$facet/$bucket: 分面搜索，根据不同范围条件，多个维度一次性进行分组输出</p>
<h2 id="优化">优化</h2>
<ul>
<li>查询时，尽量使用索引，为经常做查询的条件添加索引</li>
<li>查询时，只查询需要的字段，而不是查询全部，减少网络资源的浪费</li>
<li>更新时，只更新必要的字段，而不是每次更新都把整个json文档发送过去，减少网络资源的浪费</li>
<li>插入时，尽可能直接批量插入，而不是一条一条插</li>
<li>通过mongodb提供的TTL索引，可以实现过期自删数据</li>
<li>建表时，文档嵌套不超过3层</li>
<li>尽量少用count()来计算总页数，而是使用limit</li>
<li>尽量少用skip/limit形式分页，而是通过id来定位起始的位置，这点跟aws dynamoDB很像，不过至少有提供这种功能</li>
<li>尽量少用事务，跨分片事务，避免过大事务，控制更新的文档(行)数量</li>
<li>使用aggregate时，前一个stage计算得到的数据会传递到下个stage，如果前一个stage没有该数据，则下一个stage无法获取到（尽管表中有该字段）</li>
<li>使用aggregate时，pipeline最开始时的match sort可以使用到索引，一旦发生过project投射，group分组，lookup表关联，unwind打散等操作后，则无法使用索引。</li>
</ul>
<h2 id="分析">分析</h2>
<ul>
<li>在查询语句中使用explain()方法分析查询语句，有三种分析模式，通过传参的方式使用，比如：<code>db.getCollection(&quot;order&quot;).explain('executionStats').find({条件})</code>
<ul>
<li>queryPlanner：默认，只会输出被查询优化器选择出来的查询计划winningPlane</li>
<li>executionStats：除了输出被查询优化器选择出来的查询计划winningPlane，并执行语句（如果是写操作，不会真正操作数据库），给出分析结果，比如扫描的行数，使用什么索引，耗时，返回的条数等</li>
<li>allPlansExecution：列出所有可能的查询计划并执行，给出所有方案的结果，mongo支持这种分析模式，但aws的documentDB不支持</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code># 常见的stage枚举：
COLLSCAN：全表扫描
IXSCAN：索引扫描
FETCH：根据前面扫描到的位置抓取完整文档，相当于回表
IDHACK：针对_id进行查询
SHARD_MERGE 合并分片中结果
SHARDING_FILTER 分片中过滤掉孤立文档
SORT：进行内存排序，最终返回结果
SORT_KEY_GENERATOR：获取每一个文档排序所用的键值
LIMIT：使用limit限制返回数
SKIP：使用skip进行跳过
IDHACK：针对_id进行查询
COUNTSCAN：count不使用用Index进行count时的stage返回
COUNT_SCAN：count使用了Index进行count时的stage返回
TEXT：使用全文索引进行查询时候的stage返回
SUBPLA：未使用到索引的$or查询的stage返回
PROJECTION：限定返回字段时候stage的返回

# 一个executionStats例子
{ 
    &quot;queryPlanner&quot; : {
        &quot;plannerVersion&quot; : 1.0, 
        &quot;namespace&quot; : &quot;库名.表名&quot;, 
        &quot;winningPlan&quot; : {
            &quot;stage&quot; : &quot;SORT_AGGREGATE&quot;, 
            &quot;inputStage&quot; : {
                &quot;stage&quot; : &quot;IXONLYSCAN&quot;, 
                &quot;indexName&quot; : &quot;索引名&quot;, 
                &quot;direction&quot; : &quot;forward&quot;
            }
        }
    }, 
    &quot;executionStats&quot; : {
        &quot;executionSuccess&quot; : true, 
        &quot;planningTimeMillis&quot; : &quot;0.276&quot;, 
        &quot;nReturned&quot; : &quot;1&quot;, 
        &quot;executionTimeMillis&quot; : &quot;10517.898&quot;,  # 执行时间
        &quot;totalKeysExamined&quot; : &quot;10519.0&quot;,  # 总扫描数
        &quot;totalDocsExamined&quot; : &quot;567542&quot;,   # 总扫描文档数
        &quot;executionStages&quot; : {
            &quot;stage&quot; : &quot;SORT_AGGREGATE&quot;, 
            &quot;nReturned&quot; : &quot;1&quot;, 
            &quot;executionTimeMillisEstimate&quot; : &quot;10517.497&quot;, 
            &quot;inputStage&quot; : {
                &quot;stage&quot; : &quot;IXONLYSCAN&quot;, # 
                &quot;nReturned&quot; : &quot;567542&quot;, # 返回的文档数
                &quot;executionTimeMillisEstimate&quot; : &quot;9786.122&quot;,  # 执行此阶段的耗时
                &quot;indexName&quot; : &quot;索引名&quot;, 
                &quot;direction&quot; : &quot;forward&quot;
            }
        }
    }, 
    &quot;serverInfo&quot; : {
        &quot;host&quot; : &quot;oms&quot;, 
        &quot;port&quot; : 27017.0, 
        &quot;version&quot; : &quot;4.0.0&quot;
    }, 
    &quot;ok&quot; : 1.0, 
    &quot;operationTime&quot; : Timestamp(1640604817, 1)
}
</code></pre><ul>
<li>对表的或对库的，使用stats()方法，比如<code>db.getCollection(&quot;order&quot;).stats()，或者db.stats()</code>，可以查询整张表的信息或整个库的统计信息</li>
</ul>
<pre tabindex="0"><code># 针对库的
{ 
    &quot;db&quot; : &quot;order&quot;,  # 库名
    &quot;collections&quot; : 11.0,  # 集合数
    &quot;objects&quot; : 4938161.0,  # 对象数
    &quot;storageSize&quot; : 4236443648.0,  # 占用磁盘大小
    &quot;indexes&quot; : 32.0,  # 索引数
    &quot;indexSize&quot; : 1424130048.0,  # 索引大小
    &quot;fileSize&quot; : 5660573696.0,   # 文件大小
    &quot;ok&quot; : 1.0, 
    &quot;operationTime&quot; : Timestamp(1640604514, 1)
}
# 针对表的
{ 
    &quot;ns&quot; : &quot;oms.order&quot;, 
    &quot;count&quot; : 749031.0,  # 数量
    &quot;size&quot; : 1479336225.0, # 大小
    &quot;avgObjSize&quot; : 1975.90745, # 每个对象的平均大小
    &quot;storageSize&quot; : 2164432896.0, # 存储大小 
    &quot;capped&quot; : false, 
    &quot;nindexes&quot; : 1.0, # 索引个数
    &quot;totalIndexSize&quot; : 31129600.0, # 总索引大小
    &quot;indexSizes&quot; : {
        &quot;_id_&quot; : 94568448.0, 
        &quot;id&quot; : 77438976.0, 
        &quot;idx_createAt_desc&quot; : 31129600.0,   # 各个索引的大小
    }, 
    &quot;ok&quot; : 1.0, 
    &quot;operationTime&quot; : Timestamp(1640327496, 1)
}
</code></pre><ul>
<li>慢查询</li>
</ul>
<pre tabindex="0"><code>
</code></pre><h1 id="复制集replica-set机制">复制集Replica Set机制</h1>
<p>一般是一主多从，所有实例存储相同数据</p>
<h2 id="特点-1">特点</h2>
<ul>
<li>数据分发，将数据从一个区域复制到另一区域，减少另一区域的读延时</li>
<li>读写分离</li>
<li>异地容灾，快速切换可用节点</li>
<li>复制集主要用于实现高可用，增加复制集的节点数目并不会提升写性能，因为写操作都发生在主节点上，但可以提升读性能。提升性能一般是使用分片的机制</li>
</ul>
<h2 id="机制">机制</h2>
<ul>
<li>一般部署奇数个复制集，至少三个，且均要有投票权，一般分为一个主节点，用于接受写入操作和选举时的投票，两个从节点，复制主节点上的数据和选举时的投票</li>
<li>主节点上所有的写操作，会被记录到oplog日志中，从节点通过在主节点上打开一个tailable游标不断获取新进入主节点的oplog，进行重放，实现与主节点的数据一致</li>
<li>通过选举实现故障恢复
<ul>
<li>每两个节点间 每2s互发心跳，5次心跳未收到时判断为节点失联</li>
<li>当主节点失联时，从节点发起选举，选出新的主节点，当失联的是从节点，则不会产生选举</li>
<li>选举算法采用raft算法</li>
<li>复制集最多可以有50个节点，但具有投票权的节点最多7个</li>
</ul>
</li>
<li>由于从节点有机会成为主节点，所以最好保证多节点的版本，配置上保持一致</li>
</ul>
<h1 id="分片机制">分片机制</h1>
<p>分片主要是对同一实例水平的横向扩展，将原本一个实例里的数据拆分出来多分片存储，最多支持1024个分片，所以实际上是所有分片的数据加起来才是完整数据，每一个分片也是一个复制集</p>
<h2 id="特点-2">特点</h2>
<ul>
<li>
<p>提升访问性能，降低节点的压力，对外提供同一入口，屏蔽内部集群部署，通过分片路由节点mongos对请求分发到不同的分片，也有负载均衡。分发的规则是通过配置节点configServer决定，配置节点存储了数据与分片的映射。</p>
<p>mongos、configServer、分片均以复制集为单位，部署多个复制集，实现高可用</p>
</li>
<li>
<p>数据存储时会自动均衡，当mongo发现数据存储分布不均衡时，会做chunk迁移，chunk的概念类似MySQL中的页，一个chunk包含多个文档 = 一页中包含多行记录</p>
</li>
<li>
<p>支持动态扩容</p>
</li>
<li>
<p>可基于集合(即表)进行分片</p>
</li>
</ul>
<h2 id="设计原则">设计原则</h2>
<ul>
<li>分片模式
<ul>
<li>基于范围：根据id或者其他字段按范围进行分片存储，每一个分片的数据上是相邻的，但可能会导致热点数据分布不均</li>
<li>基于哈希：根据指定字段进行hash，数据分布均匀，但范围查询效率低</li>
<li>基于地域、时效、tag分区</li>
</ul>
</li>
<li>分片键的选择最好选择基数大(比如id，范围大)，分布均匀，在查询条件中可以明确定位</li>
<li>数据量不超过3TB，尽可能保持2TB一个分片</li>
<li>分片的数量根据存储容量、集合(即表)和索引的占比、并发量、来决定，<strong>mongodb默认会使用物理机60%的内存来</strong></li>
</ul>
<h1 id="文档模型设计原则">文档模型设计原则</h1>
<ul>
<li>
<p>传统关系型数据库设计，从概念模型 -》逻辑模型 -》物理模型，关系明确，遵循三范式（1.要有主键，列不可分，2.每列与主键相关，3.不能存在传递依赖(不允许字段冗余)），表现形式上，一对多关系，外键在多那张表上，多对多关系，会有第三张表来做关联</p>
<p>对于文档模型，一般对应关系型数据库设计的逻辑模型阶段，通过嵌套实体数组，map或者引用字段来处理实体间的关系，字段冗余限制宽松</p>
</li>
<li>
<p>实体间的关系，一对一使用嵌套map来表示；一对多使用嵌套数组表示；多对多使用嵌套数组+冗余字段来表示；此外，也可以通过嵌套数组存id + 另一张表来表示实体间的关系，通过id来进行联表（使用aggregate + $lookup）</p>
<p><strong>注意</strong>：嵌套时要注意整个文档大小，限制是16M，读写比列，也要注意数组长度大小，一般会使用id引用模式来解决；$lookup只支持left outer join，不支持分片表</p>
</li>
<li>
<p>模式套用：</p>
<ul>
<li>场景：时序数据，解决：对于同一个实体，将其变化字段的存储和更新，聚合在内嵌数组中</li>
<li>场景：大文档、多相似字段、多相似索引，比如sku的多属性，解决：将多个相似字段转成内嵌数组，索引建立在内嵌数组的实体字段中，</li>
<li>场景：由于schemeless的特性，不同版本存在不一样的字段，需要对字段做校验，解决：增加一个版本字段，通过该字段进行判断</li>
<li>场景：计数统计，每秒要进行计数更新，不需要准确的计数，解决利用mongo的随机计数器$inc，</li>
<li>场景：精确统计，排行版，解决：使用预聚合字段，比如增加排名字段，每次更新依赖字段的同时，更新排名字段，进行排行查询时，直接根据排行字段进行排序即可，不用重新聚合</li>
</ul>
</li>
</ul>
<h1 id="索引">索引</h1>
<h2 id="原理">原理</h2>
<p>MMap存储引擎的 主键索引、普通索引、组合索引的数据结构都是B-树，而wiredtiger存储引擎则使用LSM树，类似b+树，现在wiredtiger引擎是默认的存储引擎</p>
<p><a class="link" href="https://juejin.im/post/6844903688075477000"  target="_blank" rel="noopener"
    >LSM树参考</a></p>
<p>为什么MongoDB MMAP引擎使用b-树作为索引的数据结构，而MySQL使用b+树？</p>
<ul>
<li>两种数据结构的主要区别在于b-树查询的深度比较随机，节点包含了全部数据，而b+树比较平均，b-树的全表扫描比b+树差</li>
<li>关系型数据库因为关联性强的原因，会经常出现联表操作，b+树可以加快全表扫描的速度，而Mongo鼓励表关系用数组嵌套表示，对全表扫描的需求不是特别强烈</li>
<li>Mongo一般也用于定点查询，使用b-树单次查询的效率会比较高</li>
</ul>
<h2 id="调优">调优</h2>
<ul>
<li>nosql语句最后添加.explain()来查看执行情况，类似MySQL的explain，一般关注executeTimeMillis(扫描花费的时间)、totalDocsExamined(扫描的总条数)、executionStages.docsExamined、executionStages.inputStage.stage(使用到什么索引)这几个字段</li>
<li>创建组合索引时，一般以能够  精确匹配 -》排序 -》范围匹配  的字段顺序进行创建</li>
<li>可以创建部分索引，比如对id&gt;50的文档才会对id创建索引；对有值的字段才建索引，需要在创建索引时使用partialFilterExpression表达式</li>
<li>创建索引时使用后台创建索引，{background: true}</li>
</ul>
<h1 id="引擎">引擎</h1>
<h2 id="mmap">MMAP</h2>
<h2 id="wiredtiger">wiredtiger</h2>
<p>有空再补&hellip;</p>
<h1 id="事务">事务</h1>
<p>mongo是分布式数据库，通过部署多复制集来实现，单个MongoDB server不支持事务，至少需要一主一从两个。</p>
<p>4.0版本支持复制集多文档事务，4.2版本支持分片事务，但其实3.2版本有支持单文档原子操作了，主要是用在单文档嵌套更新上，默认自动的，MongoDB中文档 = 行记录。</p>
<p>另外，Spring 5.1.1 / SpringBoot 2.x 以上 @Transactional可以支持Mongo，需要为TransactionManager注入MongoDBFactory</p>
<h2 id="分布式下的写操作">分布式下的写操作</h2>
<p>对于事务内多文档执行写操作，保证原子性，失败能回滚</p>
<h3 id="writeconcern参数">writeConcern参数</h3>
<p>通过参数writeConcern来保证写操作到达多少个节点才算成功，写操作会等到写到复制集后才会返回</p>
<p>使用：nosql语句里包含{writeConcern: {w: 1, timeout: 3000}}，单位毫秒，超时不意味着都写失败，有可能已经写入了一些节点了，写操作性能会取决于节点的数量，会影响写入的时间，但对集群不会有压力</p>
<ul>
<li>默认值为1，表示数据被写入到一个节点就算成功</li>
<li>=[数字x]，表示数据被写入到x个节点就算成功</li>
<li>=0，表示发出的写操作，不关心是否成功</li>
<li>=majority（推荐）表示发出的写操作需要写入到多数复制集上才算成功，一般写操作写入主节点，由主节点同步给从节点</li>
<li>=all，需要全部节点确认，但如果同步时有节点挂了，此时写操作会被阻塞</li>
</ul>
<h3 id="journal参数">journal参数</h3>
<p>写操作时，会先写到内存，在写入磁盘（journal日志文件和数据文件），参数journal字段来保证达到哪步操作才算成功，由配置文件里<code>storage.journal.enabled</code>控制是否开启，<code>storage.journal.commitInternalMs</code>决定刷盘时间间隔</p>
<p>使用：nosql语句里包含 {journal: {j: true}} 会保证每次写入都会进行刷盘</p>
<ul>
<li>=true，表示写操作要落到journal日志文件才算成功</li>
<li>=false，表示写操作到达内存就算成功</li>
</ul>
<h3 id="journal日志与oplog日志的区别">journal日志与oplog日志的区别</h3>
<ul>
<li>
<p><strong>journal日志</strong>：由MongoDB引擎层使用，<strong>主要用于控制写操作是否立即持久化</strong>，因为如果发生写操作，mongo一般是先将写操作写入内存，在定时（默认是1分钟）将内存里的数据刷盘持久化。</p>
<p>如果写操作的成功判定出现在写完内存后，如果此时宕机，将会丢失写操作的记录，如果判定发生在写完journal日志之后，如果宕机可以利用journal日志进行恢复。</p>
<p>写入journal日志时，也是先写入内存，再定时（默认是100ms）写入磁盘</p>
</li>
<li>
<p><strong>oplog日志</strong>：只用在主从复制集的使用，通过oplog来<strong>实现节点间的数据同步</strong>，从节点获取主节点的oplog日志后进行重放，同步数据。oplog本身在MongoDB里是一个集合(表)</p>
<p>mongo的一次写操作，包括 1.将文档数据写进集合 2.更新集合的索引信息 3.写入oplog日志，（此时只是写入内存），这三个步骤是原子性的，要么成功要么失败。一次写操作可以是批量的也可以是单条，一次写操作对应一条journal日志。</p>
</li>
<li>
<p><strong>开启jourbal和writeConcern后的数据写入顺序</strong>：</p>
<ol>
<li>写操作进来，先将写操作写入journal缓存，将写操作产生的数据写入数据缓存，将journal内存里的写操作日志同步到oplog里，异步响应给客户端；</li>
<li>后台线程检测到日志变化，将oplog同步给从节点；另外，后台每100ms会将journal缓存里的日志刷盘，每60s将数据缓存里的数据刷盘</li>
</ol>
</li>
</ul>
<h2 id="分布式下读操作">分布式下读操作</h2>
<h3 id="readpreference参数">readPreference参数</h3>
<p>读操作时，决定使用那一个节点来处理读请求，也可以配合tag使用，来指定节点访问</p>
<p>使用：可以设置在连接语句里，驱动程序API，nosql语句+.readPref(&ldquo;primary&rdquo;)</p>
<ul>
<li>=primary（默认，推荐），只选择主节点</li>
<li>=primaryPreferred：优先选择主节点，不可用时使用从节点</li>
<li>=secondary：只选择从节点，一般用于历史数据查询，针对时效性低的数据，或者报表服务的操作</li>
<li>=secondaryPreferred：优先选择从节点，不可用时选择主节点</li>
<li>=nearest：选择最近节点，根据ping time决定，一般用于异地部署</li>
</ul>
<h3 id="readconcern参数">readConcern参数</h3>
<p>读操作时，决定这个节点的数据哪些是可读的，<strong>类似MySQL中的隔离性</strong></p>
<p>使用：需要在mongo的配置文件的server参数中，增加<code>enableMajorityReadConcern: true</code>，</p>
<p>对于值枚举未available、local、majority、linearizable，需要在查询语句后 + .readConcern(&ldquo;local或者其他枚举&rdquo;)开启使用；</p>
<p>对于snapshot，则是在开启事务时指定，<code>var session = db.getMongo().startSession(); session.startTransaction({readConcern: {level: &quot;snapshot&quot;}, writeConcern: {w: &quot;majority&quot;}});</code>  session作为事务对象，配合snapshot快照、MVCC、redo log来实现事务。</p>
<ul>
<li>
<p>=available：读取所有可用数据</p>
</li>
<li>
<p>=local（默认）：读取所有可用且属于当前分片的数据，类似available，只是限制在分片上，</p>
<p>mongo为了实现数据均衡，有分片chunk迁移机制，当分片1将数据迁移至分片2，但还没迁移完成时，此时两个分片都存在该chunk数据，但是此时该数据仍属于分片1，=local时不能读到分片2的该数据，=available时则可以</p>
</li>
<li>
<p>=majority：读取在多数节点上提交完成的数据，通过MVCC机制实现，<strong>作用类似MySQL中的提交读隔离级别</strong>。</p>
<p>比如，当读操作指向主节点，且写操作已经同步到多数从节点时，才可以读到该数据；当读操作指向一个从节点，且从节点完成写操作，且通知了主节点并得到主节点的响应时，才能读到该数据。</p>
<p>作用：</p>
<ol>
<li>主要是防止分布式数据库脏读，这里脏读指的是，在一次写操作到达多数节点前读取了这个写操作，又由于故障之类的导致写操作回滚了，此时读到的数据就算脏读。</li>
<li>配合writeConcern=mahority来实现读写分离，向主节点写入数据，从节点也能读到数据</li>
</ol>
</li>
<li>
<p>=linearizable：线性读取文档，性能较差，<strong>作用类似MySQL中的serializable(串行化)隔离级别</strong>。</p>
<p>只对读取单个文档时有效，保证在写操作完成后一定可以读到，一次读操作需要所有节点响应</p>
</li>
<li>
<p>=snapshot：读取最近快照中的数据，<strong>作用类似MySQL中的可重复读隔离级别</strong>，事务默认60s，需要4.2的驱动，会影响chunk迁移，多文档读操作必须使用主节点读</p>
<ul>
<li>全局事务管理器通过自旋创建快照</li>
<li>实现在同一事务下读取同一数据的一致性，也可以读取同一事务内的写操作；</li>
<li>当多事务内出现写操作冲突时，排在后面事务的写操作会失败，触发abort错误，此时只能把该事务抛弃，再重新开始事务</li>
<li>当事务外和事务内的写操作冲突，事务内的写操作早于事务外的写操作，事务外的写操作会进入等待，直到事务内提交，才会执行</li>
</ul>
</li>
</ul>
<h1 id="change-stream">Change Stream</h1>
<ul>
<li>
<p>类似MySQL中的触发器，但它是异步的，非事务，实现变更追踪，在应用回调中触发，可同时触发多个触发器，故障后会从故障点恢复执行（故障前会拿到id，通过id来恢复）</p>
</li>
<li>
<p>基于oplog实现，在oplog上开启tailable cursor追踪复制集上的变更操作，可追踪的事件包括ddl、dml语句，在ddl、dml语句执行后触发</p>
</li>
<li>
<p>使用时需要开启readConcern，且设置read/writeConcern：majority，只推送已经在大多数节点上提交的变更操作</p>
</li>
<li>
<p>使用：<code>db.[具体的collectionName].watch([...]).操作函数</code>，当满足watch里的条件时会触发操作方法</p>
</li>
<li>
<p>使用场景：跨集群复制、微服务变更数据库时通知其他微服务</p>
</li>
</ul>
<h1 id="备份和恢复">备份和恢复</h1>
<p>备份主要是为了防止误操作，一个节点的误操作会同步到其他节点，备份同时也可以进行数据回溯</p>
<h2 id="备份方案">备份方案</h2>
<ul>
<li>
<p>延迟节点备份，通过设置一个延迟节点，比如让其与主节点的存储差距延迟一个小时的数据量，通过oplog + oplog window重放实现</p>
</li>
<li>
<p>全量备份，数据文件快照(一般是某个时间点) + oplog(该时间点之后操作日志记录)实现</p>
<p><code>mongodump -h [需要备份的mongo实例的host:port] -d [数据库名称] -o [备份存放路径]</code>命令保存数据快照</p>
<p>恢复：<code>mongorestore -h [目标Mongo实例的host:port] -d [数据库实例名称] [[快照所在的路径]| -dir [快照所在的路径]]</code></p>
</li>
</ul>
<h1 id="监控">监控</h1>
<p>一般使用mongodb的ops manager，或者grafana实现</p>
<h2 id="监控指标">监控指标</h2>
<p>通过db.serverStatus()方法来获取指标，serverStatus方法记录的是自mongo启动以来的指标数据，常见指标有很多，一般会关注下面几个</p>
<ul>
<li>connections：连接数信息</li>
<li>locks：mongoDB使用锁的情况</li>
<li>network：网络使用情况统计</li>
<li>opconters：CURD执行次数统计</li>
<li>repl：复制集配置信息</li>
<li>men：内存使用情况</li>
<li>scan and order：每秒内存排序操作的平均比例</li>
<li>oplog window：代表oplog可容纳多长时间的操作，表示从节点可以离线多久后可以追上主节点的数据</li>
<li>wiredTiger：包含大量WirdTiger引擎执行情况的信息，如block-manager：WT数据块的读写情况，session：session使用量，concurrentTransactions：ticket使用情况</li>
<li>metrics：一系列指标统计信息</li>
</ul>
<h1 id="参考">参考</h1>
<p>极客时间 - mongodb高手课</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/mongodb/">MongoDB</a>
        
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
        
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93-%E9%94%81/">数据库-锁</a>
        
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/">数据库事务</a>
        
            <a href="/tags/%E7%B4%A2%E5%BC%95/">索引</a>
        
            <a href="/tags/%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84/">主从架构</a>
        
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/">数据库优化</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            Last updated on Dec 25, 2021 00:00 UTC
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer="true"
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/p/mysql/">
        
        

        <div class="article-details">
            <h2 class="article-title">MySQL</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/redis/">
        
        

        <div class="article-details">
            <h2 class="article-title">Redis</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Nixum Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.6.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">

            <section class="widget archives">
                <form action="/search/" class="search-form widget" >
        <p>
            <label>Search</label>
            <input name="keyword" required placeholder="Type something..." />
        
            <button title="Search">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



            </button>
        </p>
    </form>
            </section>

            <section class="widget archives">
                <h2 class="widget-title section-title">Contents</h2>

                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#特点">特点</a></li>
    <li><a href="#nosql语句">NoSQL语句</a>
      <ol>
        <li><a href="#连接">连接</a></li>
        <li><a href="#聚合">聚合</a></li>
        <li><a href="#优化">优化</a></li>
        <li><a href="#分析">分析</a></li>
      </ol>
    </li>
    <li><a href="#复制集replica-set机制">复制集Replica Set机制</a>
      <ol>
        <li><a href="#特点-1">特点</a></li>
        <li><a href="#机制">机制</a></li>
      </ol>
    </li>
    <li><a href="#分片机制">分片机制</a>
      <ol>
        <li><a href="#特点-2">特点</a></li>
        <li><a href="#设计原则">设计原则</a></li>
      </ol>
    </li>
    <li><a href="#文档模型设计原则">文档模型设计原则</a></li>
    <li><a href="#索引">索引</a>
      <ol>
        <li><a href="#原理">原理</a></li>
        <li><a href="#调优">调优</a></li>
      </ol>
    </li>
    <li><a href="#引擎">引擎</a>
      <ol>
        <li><a href="#mmap">MMAP</a></li>
        <li><a href="#wiredtiger">wiredtiger</a></li>
      </ol>
    </li>
    <li><a href="#事务">事务</a>
      <ol>
        <li><a href="#分布式下的写操作">分布式下的写操作</a>
          <ol>
            <li><a href="#writeconcern参数">writeConcern参数</a></li>
            <li><a href="#journal参数">journal参数</a></li>
            <li><a href="#journal日志与oplog日志的区别">journal日志与oplog日志的区别</a></li>
          </ol>
        </li>
        <li><a href="#分布式下读操作">分布式下读操作</a>
          <ol>
            <li><a href="#readpreference参数">readPreference参数</a></li>
            <li><a href="#readconcern参数">readConcern参数</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#change-stream">Change Stream</a></li>
    <li><a href="#备份和恢复">备份和恢复</a>
      <ol>
        <li><a href="#备份方案">备份方案</a></li>
      </ol>
    </li>
    <li><a href="#监控">监控</a>
      <ol>
        <li><a href="#监控指标">监控指标</a></li>
      </ol>
    </li>
    <li><a href="#参考">参考</a></li>
  </ol>
</nav>
                </div>
            </section>

            <section class="widget archives">
                <h2 class="widget-title section-title">Other Article Tags</h2>
                <section class="widget tagCloud">
    <div class="tagCloud-tags">
        
            <a href="/tags/%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84/" class="font_size_3">
                主从架构
            </a>
        
            <a href="/tags/javase/" class="font_size_2">
                JavaSE
            </a>
        
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="font_size_2">
                数据库
            </a>
        
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93-%E9%94%81/" class="font_size_2">
                数据库-锁
            </a>
        
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/" class="font_size_2">
                数据库事务
            </a>
        
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" class="font_size_2">
                数据库优化
            </a>
        
            <a href="/tags/%E7%B4%A2%E5%BC%95/" class="font_size_2">
                索引
            </a>
        
            <a href="/tags/context%E5%8E%9F%E7%90%86/" class="font_size_1">
                context原理
            </a>
        
            <a href="/tags/docker/" class="font_size_1">
                docker
            </a>
        
            <a href="/tags/etcd/" class="font_size_1">
                etcd
            </a>
        
            <a href="/tags/git/" class="font_size_1">
                git
            </a>
        
            <a href="/tags/go/" class="font_size_1">
                Go
            </a>
        
            <a href="/tags/go-channel%E5%8E%9F%E7%90%86/" class="font_size_1">
                Go channel原理
            </a>
        
            <a href="/tags/go-gc/" class="font_size_1">
                Go GC
            </a>
        
            <a href="/tags/go-slice%E5%92%8Cmap%E5%8E%9F%E7%90%86/" class="font_size_1">
                Go slice和map原理
            </a>
        
            <a href="/tags/goroutine/" class="font_size_1">
                Goroutine
            </a>
        
            <a href="/tags/go%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/" class="font_size_1">
                Go内存模型
            </a>
        
            <a href="/tags/go%E5%B9%B6%E5%8F%91/" class="font_size_1">
                Go并发
            </a>
        
            <a href="/tags/http/" class="font_size_1">
                HTTP
            </a>
        
            <a href="/tags/ioc%E5%92%8Caop/" class="font_size_1">
                IOC和AOP
            </a>
        
            <a href="/tags/istio/" class="font_size_1">
                Istio
            </a>
        
            <a href="/tags/java-bio/" class="font_size_1">
                Java BIO
            </a>
        
            <a href="/tags/java-gc/" class="font_size_1">
                Java GC
            </a>
        
            <a href="/tags/java-nio/" class="font_size_1">
                Java NIO
            </a>
        
            <a href="/tags/java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/" class="font_size_1">
                Java内存模型
            </a>
        
            <a href="/tags/java%E5%B9%B6%E5%8F%91/" class="font_size_1">
                Java并发
            </a>
        
            <a href="/tags/java%E9%9B%86%E5%90%88%E7%B1%BB%E5%8E%9F%E7%90%86/" class="font_size_1">
                Java集合类原理
            </a>
        
            <a href="/tags/juc/" class="font_size_1">
                JUC
            </a>
        
            <a href="/tags/jvm/" class="font_size_1">
                JVM
            </a>
        
            <a href="/tags/jwt/" class="font_size_1">
                JWT
            </a>
        
            <a href="/tags/kubernetes/" class="font_size_1">
                Kubernetes
            </a>
        
            <a href="/tags/linux/" class="font_size_1">
                Linux
            </a>
        
            <a href="/tags/mongodb/" class="font_size_1">
                MongoDB
            </a>
        
            <a href="/tags/mysql/" class="font_size_1">
                MySQL
            </a>
        
            <a href="/tags/netty/" class="font_size_1">
                Netty
            </a>
        
            <a href="/tags/orm/" class="font_size_1">
                ORM
            </a>
        
            <a href="/tags/redis/" class="font_size_1">
                Redis
            </a>
        
            <a href="/tags/rpc/" class="font_size_1">
                RPC
            </a>
        
            <a href="/tags/session%E5%92%8Ccookie/" class="font_size_1">
                session和cookie
            </a>
        
            <a href="/tags/socket/" class="font_size_1">
                socket
            </a>
        
            <a href="/tags/spring/" class="font_size_1">
                Spring
            </a>
        
            <a href="/tags/spring-security/" class="font_size_1">
                Spring Security
            </a>
        
            <a href="/tags/springboot/" class="font_size_1">
                SpringBoot
            </a>
        
            <a href="/tags/springmvc/" class="font_size_1">
                SpringMVC
            </a>
        
            <a href="/tags/tcp/" class="font_size_1">
                TCP
            </a>
        
            <a href="/tags/udp/" class="font_size_1">
                UDP
            </a>
        
            <a href="/tags/uml/" class="font_size_1">
                UML
            </a>
        
            <a href="/tags/zookeeper/" class="font_size_1">
                zookeeper
            </a>
        
            <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" class="font_size_1">
                分布式事务
            </a>
        
            <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA/" class="font_size_1">
                分布式理论
            </a>
        
    </div>
</section>
            </section>

        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
